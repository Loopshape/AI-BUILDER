<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Local AI Prompt</title>
<style>
  body{background:#1e1e1e;color:#cfcfcf;font-family:monospace;padding:18px}
  #out{white-space:pre-wrap;height:60vh;overflow:auto;border:1px solid #333;padding:10px;background:#111}
  #prompt{width:100%;padding:10px;background:#222;border:1px solid #333;color:#fff}
  button{margin-top:8px;padding:8px}
</style>
</head>
<body>
<h2>Local AI â€” prompt-only</h2>
<input id="prompt" placeholder="Type or use voice..." autofocus />
<button id="voice">ðŸŽ¤ Voice</button>
<div id="out"></div>

<script>
const out=document.getElementById('out');
const p=document.getElementById('prompt');
const v=document.getElementById('voice');

async function submitPrompt(prompt){
  out.textContent += `> ${prompt}\n`;
  p.value='';
  const es = new EventSource(`/api/stream?prompt=${encodeURIComponent(prompt)}`);
  let buffer='';
  es.onmessage = e=>{
    if(e.data==='[DONE]'){ es.close(); out.textContent += '\n'; return; }
    buffer += e.data;
    out.textContent = out.textContent.split('\n').slice(0,-1).join('\n') + '\n' + buffer;
    out.scrollTop = out.scrollHeight;
  };
}

v.addEventListener('click', async ()=>{
  v.disabled=true; v.textContent='ðŸŽ™ Listening...';
  try{
    const resp=await fetch('/api/listen',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({duration:5})});
    const j=await resp.json();
    if(j.text){ p.value=j.text; submitPrompt(j.text); }
    else alert('No speech or STT error.');
  }catch(e){ alert('Voice failed'); console.error(e); }
  v.disabled=false; v.textContent='ðŸŽ¤ Voice';
});

p.addEventListener('keyup',e=>{ if(e.key==='Enter'){ submitPrompt(p.value.trim()); } });
</script>
</body>
</html>
